import{b as f,R as u,K as l,M as w}from"./ResponseResult.f1dd6b90.js";import{o as d}from"./openDB.477f2690.js";import{I as h}from"./baseline-close.c82a44f0.js";import{_ as p,d as y,a as r,c as s,b as n,t as c,x as m,F as g,A as b,f as k,g as x}from"./index.1605adbd.js";const K=async()=>{const e=await d(),t=e.transaction("authorization"),o=await t.store.get("token");if(t.done.catch(a=>{console.error(a)}),e.close(),o===void 0)throw new Error("indexedDB token not found");return o},_=async e=>{const t=await d(),o=t.transaction("authorization","readwrite");o.store.put(e,"token"),o.done.catch(a=>{console.error(a)}),t.close()},T=async()=>{const e=await d(),t=e.transaction("authorization"),o=await t.store.get("refreshToken");if(t.done.catch(a=>{console.error(a)}),e.close(),o===void 0)throw new Error("indexedDB refresh token not found");return o},z=async e=>{const t=await fetch(`${f}/v1_0/authorizations`,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${e}`}});return t.ok?new u("updateToken","success",t):new u("updateToken","failure",t)},O=e=>{const t=new w("autoUpdateTokenRetry");return async(...o)=>l(await e(...o)).with({responseType:"success"},a=>(t.enqueue(a),t.succeed(),t)).with({responseType:"failure"},a=>l(a.responseContent).with({status:401},async()=>(t.enqueue(a),await B(t))).otherwise(()=>(t.enqueue(a),t.fail(),t))).exhaustive()},B=async e=>{const t=await T();return l(await z(t)).with({responseType:"success"},async o=>{e.enqueue(o),e.succeed();const a=await o.responseContent.json();return _(a.data.token),e}).otherwise(o=>(e.enqueue(o),e.fail(),e))};const A={class:"article-item"},C={class:"top"},j={class:"title"},D=["src"],I={key:0,class:"center"},$=["src"],q={class:"bottom"},E={class:"author"},S={class:"comments"},M={class:"date"},U={class:"close"},F=y({__name:"ArticleItem",props:{article:null},setup(e){const t=o=>{const a=o.getFullYear(),i=(o.getMonth()+1).toString().padStart(2,"0"),v=o.getDate().toString().padStart(2,"0");return`${a}\u5E74${i}\u6708${v}\u65E5`};return(o,a)=>(r(),s("div",A,[n("div",C,[n("h3",j,c(e.article.title),1),e.article.cover.type===1?(r(),s("img",{key:0,class:"cover",src:e.article.cover.urls[0],alt:"picture"},null,8,D)):m("",!0)]),e.article.cover.type===3?(r(),s("div",I,[(r(!0),s(g,null,b(e.article.cover.urls,i=>(r(),s("img",{key:i,class:"cover",src:i,alt:"picture"},null,8,$))),128))])):m("",!0),n("div",q,[n("span",E,c(e.article.author),1),n("span",S,c(e.article.commentsCount)+"\u8BC4\u8BBA",1),n("span",M,c(t(e.article.publishDate)),1),n("div",U,[k(x(h),{class:"icon"})])])]))}});var P=p(F,[["__scopeId","data-v-6e8d2648"]]);export{P as A,O as a,K as g};
