import{a as p,c as w,b as r,_ as y,d as x,p as k,h as C,i as P,r as v,j as L,S as z,u as O,n as g,f as B,g as F,w as $,v as I,t as q,B as H,k as G,l as Y,m as J}from"./index.1605adbd.js";import{o as T}from"./openDB.477f2690.js";import{b as V,R as h,K as b,M as K}from"./ResponseResult.f1dd6b90.js";const Q={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},W=r("path",{fill:"currentColor",d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2s2 .9 2 2s-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1c1.71 0 3.1 1.39 3.1 3.1v2z"},null,-1),X=[W];function Z(e,o){return p(),w("svg",Q,X)}var ee={name:"ic-baseline-lock",render:Z};const oe={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},te=r("path",{fill:"currentColor",d:"M15.5 1h-8A2.5 2.5 0 0 0 5 3.5v17A2.5 2.5 0 0 0 7.5 23h8a2.5 2.5 0 0 0 2.5-2.5v-17A2.5 2.5 0 0 0 15.5 1zm-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5s1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zm4.5-4H7V4h9v14z"},null,-1),ae=[te];function ne(e,o){return p(),w("svg",oe,ae)}var ie={name:"ic-baseline-phone-iphone",render:ne};const se=e=>(k("data-v-447942d7"),e=e(),C(),e),re=se(()=>r("p",null,"\u7535\u8BDD\u53F7\u7801\u683C\u5F0F\u9519\u8BEF\uFF0811\u4F4D\u6570\u5B57\uFF0C\u4E14\u4EE513\u300115\u300117\u300118\u300119\u5F00\u5934\uFF09",-1)),ce=[re],le=x({__name:"ThePhoneNumberInvalidSlot",emits:["close"],setup(e,{emit:o}){const t=()=>{o("close")};return(c,i)=>(p(),w("div",{class:"slot-container",onClick:t},ce))}});var ue=y(le,[["__scopeId","data-v-447942d7"]]);const de=e=>(k("data-v-b964dcd8"),e=e(),C(),e),ve=de(()=>r("p",null,"\u9A8C\u8BC1\u7801\u683C\u5F0F\u9519\u8BEF\uFF086\u4F4D\u6570\u5B57\uFF09",-1)),pe=[ve],fe=x({__name:"TheVerificationCodeInvalidSlot",emits:["close"],setup(e,{emit:o}){const t=()=>{o("close")};return(c,i)=>(p(),w("div",{class:"slot-container",onClick:t},pe))}});var he=y(fe,[["__scopeId","data-v-b964dcd8"]]);const we=e=>(k("data-v-7edca8a0"),e=e(),C(),e),_e=we(()=>r("p",null,"\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\uFF0C\u6CE8\u610F\u67E5\u6536",-1)),me=[_e],ge=x({__name:"TheSendVerificationSuccessfullySlot",emits:["close"],setup(e,{emit:o}){const t=()=>{o("close")};return P(()=>{setTimeout(()=>{o("close")},3e3)}),(c,i)=>(p(),w("div",{class:"slot-container",onClick:t},me))}});var be=y(ge,[["__scopeId","data-v-7edca8a0"]]);const ye=async e=>{const o=await fetch(`${V}/v1_0/sms/codes/${e}`,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json;charset=utf-8"}});return o.ok?new h("getVerificationCode","success",o):new h("getVerificationCode","failure",o)},xe=async(e,o)=>{const t=await fetch(`${V}/v1_0/authorizations`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({mobile:e,code:o})});return t.ok?new h("getAuthorization","success",t):new h("getAuthorization","failure",t)},ke=async e=>{const o=await fetch(`${V}/v1_0/user`,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:`Bearer ${e}`}});return o.ok?new h("getUserInformation","success",o):new h("getUserInformation","failure",o)},l=new K("login"),Ce=async(e,o)=>b(await xe(e,o)).with({responseType:"success"},async t=>{l.enqueue(t);const c=await Se(t.responseContent);return b(await ke(c)).with({responseType:"success"},i=>(l.enqueue(i),l.succeed(),l)).otherwise(i=>(l.enqueue(i),l.fail(),l))}).otherwise(t=>(l.enqueue(t),l.fail(),l)),Se=async e=>{const o=await e.json(),t=o.data.token,c=o.data.refresh_token,i=await T(),d=i.transaction(["authorization","view"],"readwrite");return d.objectStore("authorization").put(t,"token"),d.objectStore("authorization").put(c,"refreshToken"),d.objectStore("view").put("/main","viewPath"),d.done.catch(_=>{console.error(_)}),i.close(),t};const A=e=>(k("data-v-e642ec52"),e=e(),C(),e),Be={class:"login-view"},Fe=A(()=>r("h2",{class:"login-heading"}," \u767B\u5F55 ",-1)),Ve={class:"login-main"},ze=["disabled"],$e=A(()=>r("span",{class:"privacy-policy"},"\u9690\u79C1\u6761\u6B3E",-1)),Ie=x({__name:"LoginView",setup(e){let o=v(""),t=v(!0),c=v(""),i=v(!0);const d=()=>{/^1[35789]\d{9}$/.test(o.value)?t.value=!0:t.value=!1},_=()=>{/^\d{6}$/.test(c.value)?i.value=!0:i.value=!1};let u=v(!1),f=v(0);const E=L(()=>{switch(f.value){case 0:return z;case 1:return ue;case 2:return he;case 3:return be;default:return z}}),D=async()=>{if(d(),!t.value){u.value=!0,f.value=1;return}j(),b(await ye(o.value)).with({responseType:"success"},async()=>{u.value=!0,f.value=3}).otherwise(()=>{console.error("getVerificationCode failed")})};let m=v("\u83B7\u53D6\u9A8C\u8BC1\u7801"),S=v(!1);const j=()=>{S.value=!0,m.value="\u5269\u4F5960\u79D2";let a=60;const s=setInterval(()=>{a-=1,a<=0?(m.value="\u83B7\u53D6\u9A8C\u8BC1\u7801",S.value=!1,clearInterval(s)):m.value=`\u5269\u4F59${a}\u79D2`},1e3)},R=O(),M=async()=>{if(d(),!t.value){u.value=!0,f.value=1;return}if(_(),!i.value){u.value=!0,f.value=2;return}u.value=!0,f.value=0,b(await Ce(o.value,c.value)).with({responseType:"success"},async a=>{const s=await a.lastContent().json();await N(s),u.value=!1,R.push("/main/account")}).otherwise(a=>{console.log(a.responseResultQueue)})},N=async a=>{const s=await T(),n=s.transaction("userInformation","readwrite");n.store.put(a.data.id,"id"),n.store.put(a.data.name,"name"),n.store.put(a.data.photo,"avatarUrl"),n.store.put(a.data.intro,"introduction"),n.store.put(Boolean(a.data.is_media),"isWeMedia"),n.store.put(a.data.ceti,"certification"),n.store.put(a.data.art_count,"articleCount"),n.store.put(a.data.fans_count,"fansCount"),n.store.put(a.data.follow_count,"followerCount"),n.store.put(a.data.like_count,"likeCount"),n.done.catch(U=>{console.error(U)}),s.close()};return(a,s)=>(p(),w("div",Be,[Fe,r("main",Ve,[r("div",{class:g(["row",{"-invalid":!t.value}])},[B(F(ie),{class:"icon-block"}),$(r("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>o.value=n),class:g(["phone-number",{"-invalid":!t.value}]),type:"number",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",onBlur:d},null,34),[[I,o.value,void 0,{number:!0}]])],2),r("div",{class:g(["row",{"-invalid":!i.value}])},[B(F(ee),{class:"icon-block"}),$(r("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>c.value=n),class:g(["verification-code",{"-invalid":!i.value}]),type:"password",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",maxlength:"6",onBlur:_},null,34),[[I,c.value,void 0,{trim:!0}]])],2),r("button",{class:"send-verification",disabled:S.value,onClick:D},q(m.value),9,ze),r("button",{class:"login-button",onClick:M}," \u786E\u5B9A "),$e]),B(H,{modelValue:u.value,"onUpdate:modelValue":s[3]||(s[3]=n=>u.value=n),"backdrop-theme":"light","slot-transition-name":"scale","enable-close":!1},{default:G(()=>[(p(),Y(J(F(E)),{onClose:s[2]||(s[2]=n=>u.value=!1)},null,32))]),_:1},8,["modelValue"])]))}});var De=y(Ie,[["__scopeId","data-v-e642ec52"]]);export{De as default};
