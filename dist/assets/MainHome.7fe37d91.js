import{a as s,c,e as u,_ as x,d as Y,x as F,y as O,F as M,z as D,A as W,t as B,w as T,C as L,h as v,i as z,r as m,s as K,k as I,j as y,q as G,p as oe,f as le,D as ie,B as Q,n as ce,E as re}from"./index.ae061ee8.js";import{b as N,R as k,K as R}from"./ResponseResult.f1dd6b90.js";import{g as J,a as P,A as de,R as ue,b as he}from"./ReadArticleLoading.894a14ee.js";import{I as q}from"./baseline-close.4e5dc0bb.js";import"./round-star.f65dba17.js";import"./openDB.477f2690.js";const ve=async()=>{const t=await fetch(`${N}/v1_0/user/channels`,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:`Bearer ${await J()}`}});return t.ok?new k("getUserChannels","success",t):new k("getUserChannels","failure",t)},pe=P(ve),fe={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},_e=u("path",{fill:"currentColor",d:"M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"},null,-1),me=[_e];function we(t,a){return s(),c("svg",fe,me)}var be={name:"ic-round-menu",render:we};const ge=async()=>{const t=await fetch(`${N}/v1_0/channels`,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json;charset=utf-8"}});return t.ok?new k("getRecommendChannels","success",t):new k("getRecommendChannels","failure",t)},ye={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},xe=u("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},null,-1),ke=[xe];function Ce(t,a){return s(),c("svg",ye,ke)}var Ae={name:"ic-baseline-add",render:Ce};const $e={class:"channel-list"},Ie={class:"add"},Re=Y({__name:"RecommendChannelList",props:{isEditing:{type:Boolean}},async setup(t){let a,d;const p=t,i=F([]),C=([a,d]=O(()=>ge()),a=await a,d(),a);return R(C).with({responseType:"success"},async w=>{(await w.responseContent.json()).data.channels.forEach(_=>{i.push(_)})}).otherwise(w=>{console.error(w)}),(w,A)=>(s(),c("div",$e,[(s(!0),c(M,null,D(i,_=>(s(),c("div",{key:_.id,class:"item"},[W(B(_.name)+" ",1),T(u("div",Ie,[v(z(Ae),{class:"icon"})],512),[[L,p.isEditing]])]))),128))]))}});var Te=x(Re,[["__scopeId","data-v-7857a49a"]]);const Le={},ze={class:"channel-list-loading"};function Se(t,a){return s(),c("div",ze," Loading... ")}var je=x(Le,[["render",Se],["__scopeId","data-v-58007658"]]);const X=t=>(oe("data-v-533ae9bb"),t=t(),le(),t),Ee={class:"edit-channel"},Me={class:"row-top"},De={key:0,class:"close"},Be={class:"my-channels"},He=X(()=>u("h3",null,"\u6211\u7684\u9891\u9053",-1)),Ue={class:"channel-list"},Ve={class:"delete"},Fe={class:"recommend-channels"},Ge=X(()=>u("h3",null,"\u9891\u9053\u63A8\u8350",-1)),Ye=Y({__name:"EditChannel",props:{channels:null},emits:["close"],setup(t,{emit:a}){const d=t,p=()=>{a("close")};let i=m(!1);const C=()=>{i.value=!i.value},w=()=>{i.value=!1};return(A,_)=>(s(),c("div",Ee,[u("div",Me,[i.value?K("",!0):(s(),c("span",De,[v(z(q),{class:"icon",onClick:p})])),T(u("button",{class:"cancel",onClick:w}," \u53D6\u6D88 ",512),[[L,i.value]]),u("button",{class:"edit",onClick:C},B(i.value?"\u5B8C\u6210":"\u7F16\u8F91"),1)]),u("section",Be,[He,u("div",Ue,[(s(!0),c(M,null,D(d.channels,S=>(s(),c("div",{key:S.id,class:"item"},[W(B(S.name)+" ",1),T(u("div",Ve,[v(z(q),{class:"icon"})],512),[[L,i.value]])]))),128))])]),u("section",Fe,[Ge,(s(),I(G,null,{fallback:y(()=>[v(je)]),default:y(()=>[v(Te,{"is-editing":i.value},null,8,["is-editing"])]),_:1}))])]))}});var Ne=x(Ye,[["__scopeId","data-v-533ae9bb"]]);const Qe=async(t,a)=>{const d=await fetch(`${N}/v1_0/articles?channel_id=${t}&timestamp=${a}`,{method:"GET",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:`Bearer ${await J()}`}});return d.ok?new k("getChannelRecommendArticles","success",d):new k("getChannelRecommendArticles","failure",d)},V=P(Qe);const qe={},Oe={class:"article-list-loading"};function We(t,a){return s(),c("div",Oe," Loading... ")}var Ke=x(qe,[["render",We],["__scopeId","data-v-1eec10d4"]]);const Je={},Pe={class:"article-item-refresh"};function Xe(t,a){return s(),c("div",Pe," Refreshing... ")}var Ze=x(Je,[["render",Xe],["__scopeId","data-v-493ef95d"]]);const et={},tt={class:"article-item-load-more"};function at(t,a){return s(),c("div",tt," More Article Loading... ")}var nt=x(et,[["render",at],["__scopeId","data-v-e06cb4a2"]]);const st=(t,a)=>{let d=0;return(...p)=>{const i=Date.now();if(i-d>a)return d=i,t(...p)}},ot=t=>{let a=!1;return(...d)=>{if(!a)return a=!0,window.requestAnimationFrame(()=>{a=!1}),t(...d)}};const lt={class:"main-home"},it={class:"suspense-container"},ct={class:"channel-tab-bar"},rt=["onClick"],dt={class:"title"},ut={class:"transition-container"},ht=Y({__name:"MainHome",async setup(t){let a,d;const p=F([]);R(([a,d]=O(()=>pe()),a=await a,d(),a)).with({responseType:"success"},async n=>{var e,h;(await n.lastContent().json()).data.channels.forEach(r=>{p.push({id:r.id.toString(),name:r.name})}),f.value=(h=(e=p.at(0))==null?void 0:e.id)!=null?h:null}).otherwise(n=>{console.log(n.responseResultQueue)});let i=m(!1);const C=()=>{i.value=!0},w=()=>{i.value=!1};let A=m(0),_=m(!1);const S=n=>{A.value=n,_.value=!0},Z=()=>{_.value=!1};let f=m(null),H=m(!1);const g=m(null),b=F([]),$=new Map;ie(f,async n=>{if(n!==null){const o=$.get(n);if(o!==void 0)b.splice(0,b.length,...o.articles),re(()=>{var e;(e=g.value)==null||e.scrollTo({top:o.scrollTop})});else{H.value=!0;const e=Date.now();R(await V(n,e)).with({responseType:"success"},async h=>{const r=await h.lastContent().json(),U=r.data.results.map(l=>({id:parseInt(l.art_id),title:l.title,authorId:parseInt(l.aut_id),author:l.aut_name,commentsCount:parseInt(l.comm_count),publishDate:new Date(l.pubdate),cover:{type:l.cover.type,urls:l.cover.images}}));$.set(n,{articles:U,timeStamps:[e,r.data.pre_timestamp],scrollTop:0}),b.splice(0,b.length,...U)}).otherwise(h=>{console.log(h.responseResultQueue)}),H.value=!1}}});const ee=n=>{f.value=n.id},te=ot(n=>{const o=n.target.scrollTop;$.get(f.value).scrollTop=o}),ae=n=>{g.value&&(g.value.scrollTop===0?n.deltaY<0&&ne():Math.abs(g.value.scrollHeight-g.value.clientHeight-g.value.scrollTop)<1&&n.deltaY>0&&se())};let j=m(!1);const ne=st(async()=>{if(!j.value&&(j.value=!0,f.value!==null)){const n=Date.now();R(await V(f.value,n)).with({responseType:"success"},async o=>{const e=await o.lastContent().json(),h=e.data.results.map(r=>({id:parseInt(r.art_id),title:r.title,authorId:parseInt(r.aut_id),author:r.aut_name,commentsCount:parseInt(r.comm_count),publishDate:new Date(r.pubdate),cover:{type:r.cover.type,urls:r.cover.images}}));$.set(f.value,{articles:h,timeStamps:[n,e.data.pre_timestamp],scrollTop:0}),b.splice(0,b.length,...h),j.value=!1}).otherwise(o=>{console.log(o.responseResultQueue)})}},1e4);let E=m(!1);const se=async()=>{if(!E.value&&(E.value=!0,f.value!==null)){const n=$.get(f.value),o=n.timeStamps,e=o.at(o.length-1);R(await V(f.value,e)).with({responseType:"success"},async h=>{const r=await h.lastContent().json();r.data.results.map(l=>({id:parseInt(l.art_id),title:l.title,authorId:parseInt(l.aut_id),author:l.aut_name,commentsCount:parseInt(l.comm_count),publishDate:new Date(l.pubdate),cover:{type:l.cover.type,urls:l.cover.images}})).forEach(l=>{n.articles.push(l),n.timeStamps.push(r.data.pre_timestamp),b.push(l)}),E.value=!1}).otherwise(h=>{console.log(h.responseResultQueue)})}};return(n,o)=>(s(),c("div",lt,[(s(),I(G,null,{default:y(()=>[u("div",it,[u("nav",ct,[(s(!0),c(M,null,D(p,e=>(s(),c("div",{key:e.id,class:ce(["item",{"-active":f.value===e.id}]),onClick:h=>ee(e)},[u("span",dt,B(e.name),1)],10,rt))),128)),p.length>=4?(s(),c("div",{key:0,class:"menu",onClick:C},[v(z(be),{class:"icon1"})])):K("",!0)]),H.value?(s(),I(Ke,{key:0})):(s(),c("div",{key:1,ref_key:"articleListEl",ref:g,class:"article-list",onScroll:o[0]||(o[0]=e=>z(te)(e)),onWheel:o[1]||(o[1]=e=>ae(e))},[T(v(Ze,null,null,512),[[L,j.value]]),(s(!0),c(M,null,D(b,e=>(s(),I(de,{key:e.id,article:e,onClick:h=>S(e.id)},null,8,["article","onClick"]))),128)),T(v(nt,null,null,512),[[L,E.value]])],544))])]),_:1})),v(Q,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=e=>i.value=e),"slot-transition-name":"slide"},{default:y(()=>[v(Ne,{channels:p,onClose:w},null,8,["channels"])]),_:1},8,["modelValue"]),v(Q,{modelValue:_.value,"onUpdate:modelValue":o[3]||(o[3]=e=>_.value=e),"slot-transition-name":"slide"},{default:y(()=>[u("div",ut,[(s(),I(G,null,{fallback:y(()=>[v(ue)]),default:y(()=>[v(he,{id:A.value,onClose:Z},null,8,["id"])]),_:1}))])]),_:1},8,["modelValue"])]))}});var bt=x(ht,[["__scopeId","data-v-1e034230"]]);export{bt as default};
