import{I as y}from"./baseline-close.4e5dc0bb.js";import{_ as w,d as g,a as s,c as r,e as c,t as l,s as _,F as $,z,h as x,i as d,y as C,r as I,k as b,p as B,f as j}from"./index.ae061ee8.js";import{I as S}from"./round-star.f65dba17.js";import{b as k,R as v,K as f,M as D}from"./ResponseResult.f1dd6b90.js";import{o as h}from"./openDB.477f2690.js";const R=async()=>{const e=await h(),t=e.transaction("authorization"),o=await t.store.get("token");if(t.done.catch(a=>{console.error(a)}),e.close(),o===void 0)throw new Error("indexedDB token not found");return o},L=async e=>{const t=await h(),o=t.transaction("authorization","readwrite");o.store.put(e,"token"),o.done.catch(a=>{console.error(a)}),t.close()},M=async()=>{const e=await h(),t=e.transaction("authorization"),o=await t.store.get("refreshToken");if(t.done.catch(a=>{console.error(a)}),e.close(),o===void 0)throw new Error("indexedDB refresh token not found");return o},E=async e=>{const t=await fetch(`${k}/v1_0/authorizations`,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${e}`}});return t.ok?new v("updateToken","success",t):new v("updateToken","failure",t)},q=e=>{const t=new D("autoUpdateTokenRetry");return async(...o)=>f(await e(...o)).with({responseType:"success"},a=>(t.enqueue(a),t.succeed(),t)).with({responseType:"failure"},a=>f(a.responseContent).with({status:401},async()=>(t.enqueue(a),await F(t))).otherwise(()=>(t.enqueue(a),t.fail(),t))).exhaustive()},F=async e=>{const t=await M();return f(await E(t)).with({responseType:"success"},async o=>{e.enqueue(o),e.succeed();const a=await o.responseContent.json();return L(a.data.token),e}).otherwise(o=>(e.enqueue(o),e.fail(),e))};const U={class:"article-item"},N={class:"top"},V={class:"title"},G=["src"],O={key:0,class:"center"},Y=["src"],K={class:"bottom"},P={class:"author"},H={class:"comments"},J={class:"date"},Q={class:"close"},W=g({__name:"ArticleItem",props:{article:null},setup(e){const t=o=>{const a=o.getFullYear(),n=(o.getMonth()+1).toString().padStart(2,"0"),u=o.getDate().toString().padStart(2,"0");return`${a}\u5E74${n}\u6708${u}\u65E5`};return(o,a)=>(s(),r("div",U,[c("div",N,[c("h3",V,l(e.article.title),1),e.article.cover.type===1?(s(),r("img",{key:0,class:"cover",src:e.article.cover.urls[0],alt:"picture"},null,8,G)):_("",!0)]),e.article.cover.type===3?(s(),r("div",O,[(s(!0),r($,null,z(e.article.cover.urls,n=>(s(),r("img",{key:n,class:"cover",src:n,alt:"picture"},null,8,Y))),128))])):_("",!0),c("div",K,[c("span",P,l(e.article.author),1),c("span",H,l(e.article.commentsCount)+"\u8BC4\u8BBA",1),c("span",J,l(t(e.article.publishDate)),1),c("div",Q,[x(d(y),{class:"icon"})])])]))}});var ye=w(W,[["__scopeId","data-v-6e8d2648"]]);const X={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Z=c("path",{fill:"currentColor",d:"m19.65 9.04l-4.84-.42l-1.89-4.45c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18l-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.5l4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.73l3.67-3.18c.67-.58.32-1.68-.56-1.75zM12 15.4l-3.76 2.27l1-4.28l-3.32-2.88l4.38-.38L12 6.1l1.71 4.04l4.38.38l-3.32 2.88l1 4.28L12 15.4z"},null,-1),ee=[Z];function te(e,t){return s(),r("svg",X,ee)}var oe={name:"ic-round-star-border",render:te};const ae=async e=>{const t=await fetch(`${k}/v1_0/articles/${e}`,{method:"GET",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:`Bearer ${await R()}`}});return t.ok?new v("getSearchArticle","success",t):new v("getSearchArticle","failure",t)},ce=q(ae);const se=e=>(B("data-v-afb6b15c"),e=e(),j(),e),re={class:"read-article"},ne={class:"row-top"},ie={class:"close"},le=se(()=>c("div",{class:"title"}," article title ",-1)),de={class:"star"},ve=g({__name:"ReadArticle",props:{id:null},emits:["close"],async setup(e,{emit:t}){let o,a;const n=e;try{f(([o,a]=C(()=>ce(n.id)),o=await o,a(),o)).with({responseType:"success"},async i=>{const m=await i.lastContent().json();console.log(m)}).otherwise(i=>{console.error(i)})}catch(i){console.error(i)}const u=()=>{t("close")};let p=I(!1);const A=()=>{p.value=!0},T=()=>{p.value=!1};return(i,m)=>(s(),r("div",re,[c("div",ne,[c("span",ie,[x(d(y),{class:"icon",onClick:u})]),le,c("span",de,[p.value?(s(),b(d(S),{key:0,class:"icon",onClick:T})):(s(),b(d(oe),{key:1,class:"icon",onClick:A}))])])]))}});var ge=w(ve,[["__scopeId","data-v-afb6b15c"]]);const fe={},ue={class:"read-article-loading"};function pe(e,t){return s(),r("div",ue," Loading... ")}var xe=w(fe,[["render",pe],["__scopeId","data-v-11268602"]]);export{ye as A,xe as R,q as a,ge as b,R as g};
