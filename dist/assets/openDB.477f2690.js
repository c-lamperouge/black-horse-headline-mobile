var S=Object.defineProperty,j=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))k.call(t,n)&&D(e,n,t[n]);if(w)for(var n of w(t))v.call(t,n)&&D(e,n,t[n]);return e},I=(e,t)=>j(e,P(t));const A=(e,t)=>t.some(n=>e instanceof n);let B,E;function C(){return B||(B=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function T(){return E||(E=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const g=new WeakMap,b=new WeakMap,L=new WeakMap,f=new WeakMap,m=new WeakMap;function O(e){const t=new Promise((n,r)=>{const s=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{n(a(e.result)),s()},o=()=>{r(e.error),s()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(n=>{n instanceof IDBCursor&&g.set(n,e)}).catch(()=>{}),m.set(t,e),t}function x(e){if(b.has(e))return;const t=new Promise((n,r)=>{const s=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});b.set(e,t)}let p={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return b.get(e);if(t==="objectStoreNames")return e.objectStoreNames||L.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return a(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function W(e){p=e(p)}function F(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const r=e.call(h(this),t,...n);return L.set(r,t.sort?t.sort():[t]),a(r)}:T().includes(e)?function(...t){return e.apply(h(this),t),a(g.get(this))}:function(...t){return a(e.apply(h(this),t))}}function N(e){return typeof e=="function"?F(e):(e instanceof IDBTransaction&&x(e),A(e,C())?new Proxy(e,p):e)}function a(e){if(e instanceof IDBRequest)return O(e);if(f.has(e))return f.get(e);const t=N(e);return t!==e&&(f.set(e,t),m.set(t,e)),t}const h=e=>m.get(e);function V(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),d=a(o);return r&&o.addEventListener("upgradeneeded",c=>{r(a(o.result),c.oldVersion,c.newVersion,a(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),d.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",()=>s())}).catch(()=>{}),d}const K=["get","getKey","getAll","getAllKeys","count"],R=["put","add","delete","clear"],l=new Map;function M(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(l.get(t))return l.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=R.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||K.includes(n)))return;const i=async function(o,...d){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(d.shift())),(await Promise.all([u[n](...d),s&&c.done]))[0]};return l.set(t,i),i}W(e=>I(y({},e),{get:(t,n,r)=>M(t,n)||e.get(t,n,r),has:(t,n)=>!!M(t,n)||e.has(t,n)}));const H=async()=>await V("headline-mobile",1,{blocked:()=>{window.alert("Please close this app opened in other browser tabs.")},blocking:()=>{window.alert("App is outdated, please close this tab"),location.reload()},upgrade:(t,n,r,s)=>{n===0&&r===1?(t.createObjectStore("view"),t.createObjectStore("authorization"),t.createObjectStore("articleSearchHistories",{keyPath:"content"}),t.createObjectStore("userInformation")):console.error("unknown database network version change"),s.done.catch(i=>{console.error(i)})}});export{H as o};
